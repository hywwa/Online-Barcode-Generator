# 在线条形码生成器

这是一个基于Node.js和Express开发的在线条形码生成工具，支持自定义条码内容、宽度和高度，以及安全的验证码系统和灵活的条码参数设置。

## 功能特性

### 基础功能
- 自定义条码内容输入
- 支持设置条码宽度（毫米）
- 支持设置条码高度（毫米）
- 下载条码图片（PNG格式）
- 响应式设计，支持移动端访问


-条码工具上生成四位数验证码，其他用户输入验证码才能使用功能，普通用户进入前需先输入四位验证码才能进入系统使用，有效期，验证，防破解，只有管理员生成，限制验证码输入次数，要保证每个用户的隔离性

-把单个条码的宽度和条码之间的间隙改成设置的参数，用户点击设置输入密码keda就可以设置这两个参数

验证码一次性：每个验证码只能使用一次

验证码有时效：生成后24小时内有效

会话持久性：验证成功后24小时内有效

设备独立性：会话只在当前浏览器有效

验证码共享性：同一个验证码可在不同设备使用（但只能用一次）


### 安全验证码系统
- **四位数验证码生成**：管理员可生成四位数数字验证码
- **访问控制**：普通用户必须输入有效验证码才能进入系统使用
- **防破解机制**：
  - 验证码一次性：每个验证码只能成功验证使用一次
  - 有效期设置：支持1小时到7天的有效期选项
  - 尝试次数限制：限制每个验证码的最大尝试次数（默认5次）
  - IP访问限制：记录和限制异常IP的访问频率
- **用户隔离**：通过会话机制确保每个用户的操作互不影响
- **会话管理**：验证成功后创建安全会话，支持持久化访问

### 高级条码参数设置
- **自定义条码宽度**：可设置单个条码的精确宽度
- **条码间隙调整**：可自定义条码之间的间距
- **安全设置访问**：通过密码"keda"保护参数设置功能
- **即时生效**：参数修改后立即应用于新生成的条码

## 技术实现要点

### 验证码系统实现
- **验证码生成机制**：使用密码学安全的随机数生成器创建四位数验证码
- **存储结构**：采用内存中的键值存储，包含验证码、创建时间、过期时间、使用状态、尝试次数等信息
- **会话管理**：使用加密的sessionId和HTTP-Only Cookie实现安全会话
- **定期清理**：自动清理过期验证码和会话，优化内存使用
- **安全日志**：记录所有验证码验证和会话创建操作

### 条码参数设置实现
- **参数存储**：使用全局配置对象存储条码宽度和间隙参数
- **密码验证**：使用简单但有效的密码比对机制保护设置功能
- **参数验证**：确保用户输入的参数在合理范围内
- **即时应用**：参数修改后立即影响条码生成逻辑

### 重要参数配置
- **验证码有效期**：1小时到7天可选，通过admin.html中的下拉框设置
- **验证码最大尝试次数**：默认5次，可在server.js中配置
- **会话有效期**：7天（可在server.js中修改sessionExpiry和cookie的maxAge）
- **清理间隔**：定期清理过期验证码和会话的时间间隔
- **IP访问限制**：记录IP访问频率，防止暴力破解

## 安全特性

- **Cookie安全**：使用httpOnly、secure、sameSite等属性增强Cookie安全性
- **CORS配置**：严格控制跨域资源访问
- **输入验证**：对所有用户输入进行严格验证，防止注入攻击
- **错误处理**：统一的错误处理机制，避免敏感信息泄露
- **资源限制**：防止资源耗尽攻击

## 路由结构

- **/verify.html**：验证码验证页面
- **/barcode.html**：条码生成页面（需要验证后访问）
- **/admin.html**：管理员页面（生成验证码）
- **/verify-code**：验证验证码API
- **/generate-barcode**：生成条码API
- **/set-barcode-config**：设置条码参数API

## 系统流程

1. 管理员通过admin.html生成验证码并设置有效期
2. 用户访问系统时，首先进入verify.html验证页面
3. 用户输入验证码，系统验证通过后创建会话并重定向到barcode.html
4. 用户可在barcode.html页面生成条码，或通过设置功能调整条码参数
5. 会话有效期内，用户可直接访问barcode.html使用功能




## 技术栈

- **后端**：Node.js, Express
- **条形码生成**：bwip-js
- **前端**：HTML, CSS, JavaScript

## 安装与运行

### 环境要求

- Node.js (v14或更高版本)
- npm

### 安装步骤

1. 克隆或下载本项目

2. 安装依赖
   ```bash
   npm install
   ```

3. 启动开发服务器
   ```bash
   npm run dev
   ```

4. 启动生产服务器
   ```bash
   npm start
   ```

5. 访问应用
   打开浏览器，访问 http://localhost:3001

   用户端 http://106.53.219.143:3000/     设置密码 keda
   生成验证码  http://106.53.219.143:3000/admin.html    密码keda666
   code128


## API 文档

### 生成条形码

- **URL**: `/generate-barcode`
- **方法**: `POST`
- **请求体**:
  ```json
  {
    "text": "条码内容",
    "width": 100,  // 宽度（毫米）
    "height": 50   // 高度（毫米）
  }
  ```
- **响应**: 返回PNG格式的条形码图片

## 部署到腾讯云

### 准备工作

1. 确保项目可以正常运行
2. 在腾讯云控制台创建云服务器实例
3. 安装Node.js和npm

### 部署步骤

1. 将项目文件上传到云服务器

2. 安装依赖
   ```bash
   npm install --production
   ```

3. 使用PM2管理进程（推荐）
   ```bash
   npm install -g pm2
   pm2 start server.js --name "barcode-generator"
   pm2 startup
   pm2 save
   ```

4. 配置域名和反向代理
   - 安装Nginx
   - 配置Nginx反向代理到Node.js服务

## 许可证

MIT